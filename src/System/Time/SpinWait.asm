; Copyright 2022 Raphtaliyah <me@raphtaliyah.moe>
;---------------------------------------------------------------------
; Module
;---------------------------------------------------------------------
    .module SpinWait
;---------------------------------------------------------------------
; Global symbols
;---------------------------------------------------------------------
    
;---------------------------------------------------------------------
; Includes
;---------------------------------------------------------------------
    .include \src/Headers/SpinWait.h.asm\
;---------------------------------------------------------------------
; Memory initializers
;---------------------------------------------------------------------
    .area INIT (CSEG)
    .area XINIT (CSEG)
;---------------------------------------------------------------------
; Memory
;---------------------------------------------------------------------
    .area BIT   (DSEG)
    .area DATA  (DSEG)
    .area XDATA (DSEG)
;---------------------------------------------------------------------
; Constant data
;---------------------------------------------------------------------
    .area CODE (CSEG)
;---------------------------------------------------------------------
; Constants
;---------------------------------------------------------------------
    
;---------------------------------------------------------------------
; Code
;---------------------------------------------------------------------
    .area CODE (CSEG)

;--------------------------------------------
; Spin waits for the specified amount of
; milliseconds.
;--------------------------------------------
; Parameters:
;	r0 - Milliseconds to wait.
; Returns:
;	nothing
;--------------------------------------------
spinWaitMilliseconds:
    push acc
    push r0
    push r3
    push r4
    
    d1:
    mov  r3, #32
    d2:
    mov  r4, #255
    d3:
    djnz r4, d3
    djnz r3, d2
    djnz r0, d1
    
    pop r4
    pop r3
    pop r0
    pop acc
    ret