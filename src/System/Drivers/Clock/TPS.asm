; Copyright 2022 Raphtaliyah <me@raphtaliyah.moe>
;---------------------------------------------------------------------
; Module
;---------------------------------------------------------------------
    .module TimerPrescaler
;---------------------------------------------------------------------
; Global symbols
;---------------------------------------------------------------------

;---------------------------------------------------------------------
; Includes
;---------------------------------------------------------------------
    .include \src/Headers/Clocks.h.asm\
;---------------------------------------------------------------------
; Memory initializers
;---------------------------------------------------------------------
    .area INIT (CSEG)
    .area XINIT (CSEG)
;---------------------------------------------------------------------
; Memory
;---------------------------------------------------------------------
    .area BIT   (DSEG)
    .area DATA  (DSEG)
    .area XDATA (DSEG)
;---------------------------------------------------------------------
; Constant data
;---------------------------------------------------------------------
    .area CODE (CSEG)
;---------------------------------------------------------------------
; Constants
;---------------------------------------------------------------------
    .equ lowNibbleMask,     0b00001111
;---------------------------------------------------------------------
; Code
;---------------------------------------------------------------------
    .area CODE (CSEG)

;--------------------------------------------
; Sets the timer prescaler.
;--------------------------------------------
; Parameters:
;   r0 - 4 bit tps value
; Returns:
;	nothing
;--------------------------------------------
setTPS:
    push acc
    
    mov  a, r0              ; Move the 4 bits to the top nibble.
    swap a
    anl  a, #~lowNibbleMask ; Mask lower nibbles.
    mov CLKREG, a           ; Set the tps.
    
    pop acc
    ret